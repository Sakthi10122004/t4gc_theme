<!DOCTYPE html>
<html lang="{{@site.locale}}"{{#match @custom.color_scheme "Dark"}} class="dark-mode"{{else match @custom.color_scheme "Auto"}} class="auto-color"{{/match}}>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>{{meta_title}}</title>

    {{!-- Preload assets for performance --}}
    {{!-- <link rel="preload" as="style" href="{{asset "built/screen.css"}}" />
    <link rel="preload" as="script" href="{{asset "built/casper.js"}}" /> --}}

    {{!-- Main CSS --}}
    <link rel="stylesheet" href="{{asset "css/style.css"}}" />

    {{!-- Font Awesome for footer icons --}}
    {{!-- <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SzlrxWriC3pGq6fT6SU5FQ2FJpG4ZQ2I1F1Bf3x9D6N0Zl+P1Z0Jb8kXgMHC2H1Z1Q/9z6hYj8xEJ0A1r9p2w=="
        crossorigin="anonymous"
        referrerpolicy="no-referrer"
    /> --}}

    {{!-- Ghost SEO + Structured Data --}}
    {{ghost_head}}
</head>

<body class="{{body_class}}">
<div class="viewport">

    {{!-- Custom Header --}}
    <header class="site-header">
        <!-- Left Column: Logo -->
        <a class="gh-head-logo{{#unless @site.logo}} no-image{{/unless}}" href="{{@site.url}}">
            {{#if @site.logo}}
                <img src="{{@site.logo}}" alt="{{@site.title}}">
            {{/if}}
            {{@site.title}}
        </a>

        <!-- Center Column: Navigation -->
        <nav class="gh-head-menu">
            {{navigation}}
        </nav>

        <!-- Right Column: Search + Member Actions -->
        <div class="gh-head-actions">
            <!-- Search Button -->
            <button class="gh-search gh-icon-btn" aria-label="Search this site" data-ghost-search>
                {{> "icons/search"}}
            </button>

            <!-- Member Links -->
            <div class="gh-head-members">
                {{#unless @member}}
                    {{!-- {{#unless @site.members_invite_only}}
                        <a class="gh-head-link" href="#/portal/signin" data-portal="signin">Sign in</a>
                        <a class="gh-head-button" href="#/portal/signup" data-portal="signup">Subscribe</a>
                    {{else}}
                        <a class="gh-head-button" href="#/portal/signin" data-portal="signin">Sign in</a>
                    {{/unless}} --}}
                {{else}}
                    <a class="gh-head-button" href="#/portal/account" data-portal="account">Account</a>
                {{/unless}}
            </div>
        </div>
    </header>

    {{!-- Main Page Content --}}
    <div class="site-content">
        {{{body}}}
    </div>

    {{!-- Custom Footer --}}
    <footer class="site-footer">
        <div class="footer-container">
            <section class="copyright"><a href="{{@site.url}}">{{@site.title}}</a> &copy; {{date format="YYYY"}}</section>
            <nav class="site-footer-nav">
                {{navigation type="secondary"}}
            </nav>
        </div>
    </footer>


</div>

{{#is "post, page"}}
    {{> "lightbox"}}
{{/is}}

{{!-- Scripts --}}
<script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous">
</script>

<script>
$(document).ready(function () {
    // Mobile Menu Trigger
    $('.gh-burger').click(function () {
        $('body').toggleClass('gh-head-open');
    });
    // Responsive video embeds
    $(".gh-content").fitVids();
});
</script>

<script>
document.addEventListener('DOMContentLoaded', async () => {
  // STEP 1Ô∏è‚É£ - Check if token is present in URL (from signup email)
  const params = new URLSearchParams(window.location.search);
  const token = params.get('token');

  if (token) {
    // Store token for later auto-login
    localStorage.setItem('ghost_member_token', token);
    console.log("‚úÖ Member token stored successfully");
    // Optional: redirect to a dashboard or members page
    window.location.href = '/members/';
  }

  // STEP 2Ô∏è‚É£ - Auto-login using stored token
  const savedToken = localStorage.getItem('ghost_member_token');
  if (savedToken) {
    try {
      const res = await fetch('/members/api/member/', {
        headers: { 'Authorization': `Ghost ${savedToken}` }
      });

      if (res.ok) {
        const member = await res.json();
        if (member && member.email) {
          console.log("üîì Auto-logged in:", member.email);
          // You can now update the UI
          document.body.classList.add('logged-in');
          document.querySelectorAll('.login-button').forEach(btn => btn.style.display = 'none');
          document.querySelectorAll('.logout-button').forEach(btn => btn.style.display = 'inline-block');
        } else {
          console.log("‚ö†Ô∏è No member found, clearing token");
          localStorage.removeItem('ghost_member_token');
        }
      }
    } catch (err) {
      console.error("‚ùå Login check failed:", err);
      localStorage.removeItem('ghost_member_token');
    }
  }
});
</script>


{{!-- Ghost required scripts --}}
{{ghost_foot}}

</body>
</html>
